# Глоссарий Терминов
***
Термин1  
Термин2  
...

***
# Первичный список требований

***

Каждое из требований, предъявляемых к проектируемой системе, имеет один из следующих приоритетов

- H - высокий
- M - средний
- L - низкий

Категория определяет приоритет выполнения требований на последующих стадиях. Первыми реализуются требования с высоким приоритетом, вторыми - со средним, третьими - с низким. Предполагается, что требования с высоким приоритетом будут выполнены даже в худших условиях.
***
## Функциональные требования

***

1) Игрок:  
	1) Игрок должен иметь возможность запустить игру. (H)  
	2) Игрок должен иметь возможность поставить игру на паузу. (H)  
	3) Игрок должен иметь возможность выйти в главное меню. (М)  
	4) Игрок должен иметь возможность просматjривать свой профиль.(Достижения, рейтинг, оформление, отображаемое имя и картинку профиля)(M)  
	5) Игрок должен иметь возможность редактировать свой профиль.(Картинку профиля, Отображаемое имя)(M)  
2) Передача изменений в игре между игроками:  
	1) Игроки должны иметь возможность видеть прогресс друг друга.(Н)  
	2) Игроки должны иметь возможность поставить паузу для всех одновременно. (?) (M)  
	3) Игроки должны иметь возможность общаться друг с другом с помощью чата лобби, в котором они находятся.(М)  
	4) Игроки должны иметь возможность просматривать профили друг друга(L)  
3) Система сохранений:  
	1) Игрок должен иметь возможность сохранять свой прогресс, для возможности переноса между устройствами.(H)  
	2) Игрок должен иметь возможность подгрузить своё сохранение из привязанного к нему профиля.(H)  
4) Начало игры:  
	1) Игрок должен иметь возможность выбрать режим игры.  
		1) Режим "Обучение":  
			1) Игрок должен получить рекомендации, практикум и тренажёр для слепой печати.(H)  
			2) Прогресс игрока должен быть привязан к его профилю.(L)  
		2) Режим "Оффлайн игра."  
			1) Игрок должен иметь возможность выбирать параметры для выбранного режима игры. (Например, количество символов, время на выполнение задания)(L)  
			2) Игрок должен иметь возможность получать достижения, соответствующие его навыкам.(L)  
			3) Игрок должен видеть свою статистику в процессе игры. (Например, точность ввода, скорость печати, кол-во ошибок набора(M)  
		3) Режим "Онлайн игра."  
			1) Игрок должен иметь возможность создать своё лобби. (H)  
				1) Игрок должен иметь возможность задавать параметры создаваемой игры. (Например, режим игры, количество игроков, приватность лобби, пароль для подключения)(L)  
			2) Игрок должен иметь возможность подключаться к другим лобби, выбрав его из списка доступных игр.(M)  
			3) Если лобби имеет пароль, игрок должен ввести корректный пароль для подключения. (H)  
			4) Игрок должен получить уведомление в случае, если лобби заполнено или недоступно. (M)  
			5) Система должна автоматически удалять пустые лобби после выхода всех игроков. (L)  
	2) Система должна предоставить игрокам возможность дождаться присоединения всех игроков к лобби, перед стартом. (M)  
		1) Игрок-Организатор лобби должен иметь возможность видеть состояние готовности игроков в лобби, после чего, если у всех игроков выбран индикатор "Готов", нажать кнопку "Старт игры". (H)  
		 2) Игрок-участник должен иметь возможность видеть настройки лобби, а также сложность текста, отображаемого для набора в формате 1* - легко, 2* - средняя сложность, 3* - высокая сложность, 4* - чрезвычайная сложность. (L)  
5) Игровой процесс:  
	1) Фаза подготовки к набору:  
		1) Перед началом ввода текста, игрок должен видеть индикатор старта (т.е. после сигнала "Старт", игрок получит возможность набирать текст, отображаемый на экране)(M)  
		2) Игрок должен иметь возможность видеть текст, который ему предстоит набирать за 5 секунд до начала матча.(L)  
	2) Фаза набора текста:  
		1) Игрок должен иметь возможность видеть визуальное отображение корректности ввода. (Неправильно введённые символы - подсвечиваются красным, Уже введённые символы, если введены корректно - подсвечиваются белым. Ещё не введённый текст - подсвечивается серым)(H)  
		2) Игрок должен иметь возможность видеть свою статистику и ожидать подсчёта результата игры в специальном меню ожидания результатов "гонки".(M)  
	3) Фаза отображения результатов:  
		1) Игрок должен иметь возможность видеть полученные очки "Рейтинга", своё место в лобби, а также успешность прошедшей игры(статистику).(L)  
6) Рейтинговая система:  
	1) Система должна учитывать средний рейтинг игроков в лобби, подготавливая текст, наиболее подходящий для всех игроков одновременно.(H)  
	2) Система должна начислять очки при прохождении в список лучших игроков рейтингового матча. (L)  
	3) Система должна определять позицию игрока в рейтинговой таблице, а также в таблице результатов прошедшего матча.(L)  

7) Авторизация и управление учётной записью:  
	1) Пользователь должен иметь возможность зарегистрироваться в системе, указав логин, пароль и адрес электронной почты. (H)  
	2) Система должна проверять корректность введённых данных при регистрации. (H)  
	3) Пользователь должен иметь возможность войти в систему, используя логин и пароль. (H)  
	4) Пользователь должен иметь возможность восстановить пароль через электронную почту. (M)  
	5) Пользователь должен иметь возможность изменить пароль из настроек профиля. (M)  
	6) Система должна уведомлять пользователя об ошибке при неверном вводе логина или пароля. (H)  
	7) Система должна позволять игроку выйти из профиля, деактивируя токен авторизации. (H)  

8) Управление сессиями:  
	1) Игрок должен иметь возможность оставаться в системе в течение 14 дней при активном токене. (M)  
	2) При повторном входе на устройство с активным токеном авторизация должна выполняться автоматически. (M)  
	3) При выходе из системы токен должен аннулироваться, и повторный вход потребует авторизацию. (H)  
	4) В случае истечения срока действия токена система должна уведомить игрока о необходимости повторного входа. (M)  

***
## Ограничения

***

**Средства разработки:**  
1. Язык программирования C++(Клиент), Golang(Сервер).  
2. Для разработки требуется интегрированная среда разработки.  
3. Для взаимодействий с базой данных применяется PostgreSQL (и Redis).  
4. Для системы контроля версий используется Git (Github/Gitlab)  
5. Для тестирования используются подготовленные разработчиками пакеты тестирования (C++, golang для клиента и сервера соответственно.)  

**Безопасность и доступ:**  
1. Доступ к многопользовательским сессиям и участию в рейтинговой таблице требует авторизации.  
2. Токен активен 14 дней.  
3. Токен деактивируется при выходе.  
4. Пароли хранятся в зашифрованном виде.  
5. Гость(Роль) - доступ к игре и обучению без участия в многопользовательских сессиях.  
6. Игрок(Роль) - доступ к игре и обучению с возможностью участия в многопользовательских сессиях.  
7. Админ(Роль) - доступ к панели администрирования и модерирования пользователей.  

**Требования к системе (Интерфейсу):**  
1. Пользовательский интерфейс доступен только на русском языке.  
2. При регистрации логин должен содержать от 6 до 20 символов, пароль от 8 до 64 символов или специальных символов.  
3. Игра должно работать на следующих ОС  на момент разработки: Windows 10, Windows 11.  
4. Пользователь не может предоставлять более 1 лобби.  

***
# Список определений

***
## Модель предметной области

***

- **Игрок** – пользователь системы, участвующий в игре, проходящий обучение и соревнования.  
- **Профиль** – совокупность данных игрока, включая персональную информацию, достижения и статистику.  
- **Лобби** – игровое пространство, в котором собираются игроки перед началом онлайн-матча.  
- **Матч** – игровая сессия, в ходе которой оценивается скорость и точность набора текста.
- **Онлайн игра** - режим игры, позволяющий играть с другими игроками.
- **Оффлайн игра** -  режим игры, направленный на тренировку и вольный набор текста.
- **Обучение** - режим игры, направленный на изучение материала о слепой печати, сопровождаемый тренажёром прямо в процессе обучения.
- **Результат** – данные о выполнении задания отдельным игроком в рамках матча.  
- **Рейтинг** – таблица, отражающая сравнительные показатели игроков.  
- **Тренировка** – режим обучения, направленный на развитие навыков слепой печати.  
- **Достижение** – система наград за выполнение определённых условий.  
- **Чат** – средство коммуникации между игроками в лобби.  
- **Сохранение** – данные о прогрессе игрока, хранимые в профиле или на локальной машине.

// Схема продукта.

***
## Модели пользователей системы

***

1. Гость
	1. Имеет доступ к функциям обучения, тренажёру и оффлайн игре.
	2. Имеет доступ к статистике, хранящейся локально.
2. Игрок
	1. Имеет доступ к онлайн функциям.
	2. Имеет собственный профиль в приложении, синхронизирующий прогресс между устройствами.
3. Администратор
	1. Имеет доступ к панели управления приложением.
	2. Имеет доступ к модерированию правами пользователей.
	3. Имеет отдельную админ панель в виде веб-страницы с отдельным сервером авторизации.
4. Все пользователи владеют базовыми навыками использования компьютера.
5. Все пользователи знают русский язык.
6. Пользователь имеет в своём распоряжении:
	1. Клавиатуру
	2. (Опционально) Компьютерную мышь
7. Пользователь заинтересован в:
	1. Удобном и интуитивно понятном интерфейсе
	2. Звуковом сопровождении действий
	3. Приятном дизайне приложения 
	4. Понятности и полноте обучающего материала

***
## Функциональная модель

***

Сценарий 1: Запуск игры (ФТ 1.1)
Действия игрока:
	Игрок запускает приложение.
Действия системы:
	Система проверяет наличие сохранённых данных пользователя.
	Загружает главное меню игры.
Интерфейс:
	Отображается главное меню с кнопками:
	«Начать игру»
	«Профиль»
	«Настройки»
	«Выход»

Сценарий 2: Пауза и выход в главное меню (ФТ 1.2–1.3)
Действия игрока:
	Игрок нажимает клавишу Esc во время игры.
Действия системы:
	Игра останавливает таймер и процесс ввода текста.
	Отображается меню паузы с кнопками:
		«Продолжить»
		«Главное меню»
		«Выход из игры».

Сценарий 3: Просмотр профиля игрока (ФТ 1.4)
Действия игрока:
	Игрок выбирает пункт меню «Профиль».
Действия системы:
	Система отображает статистику:
	количество сыгранных матчей;
	средняя скорость набора текста;
	рейтинг игрока.

Сценарий 4: Редактирование профиля (ФТ 1.5)
Действия игрока:
	Игрок открывает свой профиль.
	Нажимает кнопку «Редактировать».
	Вводит новое имя или аватар.
	Нажимает «Сохранить».
Действия системы:
	Проверяет корректность данных.
	Сохраняет изменения в базе данных.
	Отображает обновлённые данные профиля.

Сценарий 5: Отображение прогресса других игроков в реальном времени (ФТ 2.1)
Действия игрока:
	Игрок участвует в онлайн-матче.
Действия системы:
	Передаёт данные о скорости и проценте выполнения другим участникам.
	В окне игрока отображается индикатор прогресса всех соперников.
	
Сценарий 6: Общая пауза для всех игроков (ФТ 2.2)
Действия игрока:
	Один из игроков ставит игру на паузу.
Действия системы:
	Приостанавливает матч для всех участников.
	Отображает уведомление «Игра на паузе».

Сценарий 7: Общение игроков через чат (ФТ 2.3)
Действия игрока:
	Игрок открывает чат лобби.
	Вводит сообщение и нажимает Enter.
Действия системы:
	Отправляет сообщение на сервер.
	Отображает его у всех игроков лобби.
	
Сценарий 8: Просмотр профиля другого игрока (ФТ 2.4)
Действия игрока:
	Игрок нажимает на ник другого участника.
Действия системы:
	Загружает и отображает информацию о нём (рейтинг, средняя скорость, количество матчей).

Сценарий 9: Сохранение прогресса (ФТ 3.1)
Действия игрока:
	Игрок завершает игру.
Действия системы:
	Сохраняет результаты матча в облаке или локальном профиле.

Сценарий 10: Загрузка сохранения (ФТ 3.2)
Действия игрока:
	Игрок выбирает пункт «Продолжить игру».
Действия системы:
	Загружает последнее сохранение и возобновляет процесс.

Сценарий 11: Выбор режима игры (ФТ 4.1)
Действия игрока:
	Игрок нажимает «Начать игру».
Система предлагает выбор:
	Обучение
	Оффлайн
	Онлайн

Сценарий 12: Режим “Обучение” (ФТ 4.1.1)
Действия игрока:
	Выбирает «Обучение».
Действия системы:
	Запускает режим с подсказками и примером набора текста.

Сценарий 13: Режим “Оффлайн” (ФТ 4.1.2)
Действия игрока:
	Выбирает оффлайн-режим.
Действия системы:
	Загружает случайный текст.
	Начинает игру против бота или без соперников.

Сценарий 14: Режим “Онлайн игра” (ФТ 4.1.3)
Действия игрока:
	Выбирает «Онлайн».
Действия системы:
	Отображает список доступных лобби и кнопки:
		«Создать»
		«Присоединиться»

Сценарий 15: Создание лобби (4.1.3.1)
Действия игрока:
	Игрок выбирает «Создать лобби».
	Настраивает параметры: 
		количество игроков, тип текста, приватность, пароль.
	Нажимает «Создать».
Действия системы:
	Создаёт лобби на сервере и ожидает подключения других участников.

Сценарий 16: Присоединение к лобби (ФТ 4.1.3.2)
Действия игрока:
	Игрок выбирает лобби из списка.
	Нажимает «Присоединиться».
Действия системы:
	Подключает игрока и отображает список участников.

Сценарий 17: Подключение к приватному лобби (4.1.3.3)
Действия игрока:
	Игрок вводит пароль для приватного лобби.
Действия системы:
	Проверяет корректность пароля и подключает к комнате.
	
Сценарий 18: Ошибка подключения (4.1.3.4)
Действия системы:
	Если сервер недоступен — отображает сообщение об ошибке и кнопку «Повторить попытку».

Сценарий 19: Ожидание готовности игроков (ФТ 4.2)
Действия игрока:
	После подключения нажимает «Готов».
Действия системы:
	Когда все игроки готовы, запускает обратный отсчёт и начинает игру.
	
Сценарий 20: Фаза подготовки (ФТ 5.1)
Действия системы:
	Отображает выбранный текст.
	Показывает 3-секундный таймер до старта.

Сценарий 21: Фаза набора текста (ФТ 5.2)
Действия игрока:
	Игрок начинает печатать текст.
Действия системы:
	Подсвечивает правильные и ошибочные символы.
	Обновляет скорость и прогресс.
	
Сценарий 22: Отображение результатов игры (ФТ 5.3)
Действия системы:
	После окончания текста отображает таблицу результатов:
		скорость;
		точность;
		место.

Сценарий 23: Подбор текста по рейтингу (ФТ 6.1)
Действия системы:
	Перед началом матча выбирает текст, соответствующий среднему рейтингу игроков.
	
Сценарий 24: Начисление рейтинга и отображение позиции (ФТ 6.2–6.3)
Действия системы:
	После игры обновляет рейтинг игрока.
	Отображает его место в таблице лидеров.

Сценарий 25: Регистрация нового пользователя (ФТ 7.1–7.2)
Действия игрока:
	Открывает экран регистрации.
	Вводит логин, email, пароль.
	Нажимает «Зарегистрироваться».
Действия системы:
	Проверяет уникальность данных.
	Создаёт новую запись в базе.
	Отправляет письмо для подтверждения регистрации.

Сценарий 26: Авторизация пользователя (ФТ 7.3–7.6)
Действия игрока:
	Открывает экран входа.
	Вводит логин и пароль.
	Нажимает «Войти».
Действия системы:
	Проверяет корректность данных.
	Создаёт токен сессии.
	Перенаправляет в главное меню.

Сценарий 27: Восстановление пароля (ФТ 7.4)
Действия игрока:
	Нажимает «Забыли пароль?»
	Вводит email.
Действия системы:
	Отправляет письмо со ссылкой для восстановления.
	
Сценарий 28: Изменение пароля из профиля (ФТ 7.5)
Действия игрока:
	В профиле выбирает «Сменить пароль».
	Вводит старый и новый пароль.
Действия системы:
	Проверяет старый пароль и обновляет данные.
	
Сценарий 29: Выход из профиля (ФТ 7.7)
Действия игрока:
	Нажимает «Выйти из аккаунта».
Действия системы:
	Удаляет токен и возвращает на экран авторизации.

Сценарий 30: Автоматическая авторизация (ФТ 8.1–8.2)
Действия системы:
	При запуске проверяет наличие активного токена.
	Если токен действителен — выполняет вход автоматически.

Сценарий 31: Аннулирование токена (ФТ 8.3)
Действия системы:
	При выходе из профиля токен удаляется из памяти устройства.

Сценарий 32: Истечение токена (ФТ 8.4)
Действия системы:
	По истечении срока токена выполняет автоматический выход.
	Отображает уведомление: «Сессия завершена, выполните вход снова».

***
# Высокоуровневая архитектура системы

***
## Определения

***
### Архитектура Client-Server.

***
#### Общая архитектура

***

Разработка подразумевает использования игроком клиента(приложения), установленного на его личный компьютер, взаимодействие с онлайн сервисам которого производится с помощью сервера.

// общая схема

***
## Детальные требования к основным подсистемам

***
### Сервер:

***

#### 1. Общая архитектура сервера

Сервер построен на **микросервисной архитектуре**, где каждый сервис отвечает за строго определённый функционал. Все сервисы взаимодействуют между собой через REST-запросы или внутренние RPC-вызовы.  
Основное хранилище данных — **PostgreSQL**.

Для связи с клиентом используются два канала:

- **REST API** — для запросов авторизации, профиля, статистики, рейтингов и административных функций;

- **WebSocket** — для постоянной двусторонней связи во время игры, обмена сообщениями и синхронизации состояния лобби.


Дополнительно используется **NGINX** как обратный прокси и балансировщик нагрузки:

- Приём всех входящих HTTP/HTTPS запросов.

- TLS-терминация и шифрование трафика.

- Проксирование запросов к Gateway Service, Auth Service и Game Service.

- Балансировка нагрузки между репликами микросервисов.
 
- Кэширование статических ресурсов и защита от некоторых видов DDoS-атак.


---

#### 1. Сервисы системы

##### 1. NGINX (инфраструктурная подсистема)

**Назначение:**  
Обеспечивает безопасное и эффективное взаимодействие внешних клиентов с микросервисной архитектурой сервера.

**Функции:**

1. Приём и маршрутизация HTTP/HTTPS запросов на соответствующие сервисы.

2. TLS-терминация для HTTPS.

3. Балансировка нагрузки между репликами Gateway Service и других микросервисов.

4. Кэширование статических ресурсов (при необходимости).

5. Ограничение и фильтрация подозрительных запросов.

6. Логирование запросов и ответов для мониторинга и аудита.


**Требования:**

- Поддержка последних версий TLS.

- Настройка SSL-сертификатов.

- Возможность горизонтального масштабирования при росте нагрузки.

- Совместимость с контейнеризированной инфраструктурой (Docker/Kubernetes).

- Возможность интеграции с системами мониторинга (Prometheus/Grafana).

---

#### 2. Сервисы системы

##### 2.1. Gateway Service

**Назначение:**  
Является центральной точкой входа в систему. Принимает все клиентские соединения (HTTP и WebSocket), распределяет их по внутренним сервисам и предоставляет общий модуль логирования.

**Функции:**

1. Приём REST и WebSocket соединений.

2. Маршрутизация запросов через внутренний `router`.

3. Предоставление общего пакета `logger` для всех сервисов.

4. Поддержка CORS, SSL и базовых проверок входящих данных.

5. Проксирование запросов к `auth`, `gameService` и `dbService`.


**Требования:**

- Поддержка HTTPS и JWT-аутентификации.

- Логирование всех входящих запросов и ответов.

- Возможность развёртывания как отдельного контейнера.

---

##### 2.2. Auth Service

**Назначение:**  
Обеспечивает аутентификацию, авторизацию и безопасность всей системы.

**Функции:**

1. Регистрация и вход пользователя.

2. Проверка учётных данных и выдача JWT-токенов.

3. Обновление и аннулирование токенов.

4. Предоставление middleware для валидации запросов.

5. Предоставление фильтрации и защиты от атак.


**Требования:**

- REST API: `/register`, `/login`, `/logout`, `/verify`.

- Пароли хранятся в PostgreSQL в хэшированном виде (bcrypt/argon2).

- JWT подписывается секретным ключом и проверяется на каждом запросе.

- Логирование всех попыток входа и ошибок.


---

##### 2.3. DB Service

**Назначение:**  
Служит единым слоем доступа к базе данных PostgreSQL, предоставляя унифицированные функции чтения, записи и обновления данных.

**Функции:**

1. Управление соединениями с PostgreSQL.

2. Предоставление CRUD-интерфейсов для других сервисов.

3. Обеспечение транзакционной целостности данных.

4. Реализация безопасных SQL-запросов через параметризованные выражения.

5. Хранение данных пользователей, лобби, результатов, рейтингов и статистики.


**Требования:**

- Обмен данными с другими сервисами по REST.

- Слой DAO для защиты от SQL-инъекций.

- Миграции схемы БД.

- Возможность резервного копирования.


---

##### 2.4. Game Service

**Назначение:**  
Ключевой сервис, реализующий весь игровой функционал. Объединяет модули `user`, `lobby`, `game`, `chat`, `rating`, `result`, `levelgen`.

#### Модули:

**1. user**  
Работа с профилем игрока, игровой статистикой, аватаром, ником.

- REST API: `/user/get`, `/user/update`, `/user/stats`

- Данные хранятся в PostgreSQL через `dbService`.


**2. lobby**  
Создание и управление игровыми комнатами.

- Создание/удаление лобби.

- Управление подключением и готовностью игроков.

- WebSocket для синхронизации состояния.

- REST API для списка активных лобби.


**3. game**  
Игровая логика (проведение матчей).

- Подключение участников из лобби.

- Подсчёт скорости, ошибок, завершения раунда.

- Обновление состояния в реальном времени через WebSocket.

- Получение текстов из `levelgen`.


**4. chat**  
Система сообщений между игроками в лобби или игре.

- Поддержка WebSocket.

- История сообщений может храниться в PostgreSQL (опционально).

- Фильтрация неприемлемых сообщений.


**5. rating**  
Подсистема рейтингов и таблиц лидеров.

- REST API: `/rating/global`, `/rating/user/:id`.

- Обновление рейтинга по итогам матчей.

- Поддержка сортировки и пагинации.


**6. result**  
Подсчёт и сохранение результатов.

- Расчёт точности, WPM, ошибок.

- Сохранение результатов в БД.

- Рассылка итогов игрокам через WebSocket.


**7. levelgen**  
Генерация текстов и уровней сложности.

- Подбор текста на основе средней статистики игроков.

- Возможность использовать шаблоны и темы.

- REST API: `/levelgen/generate?difficulty=...`

***
### Клиент

***

...

***
# Критерии аттестации системы

***

...

***
# Приложения

***

...