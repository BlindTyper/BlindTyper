<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WS Test</title>
  <style>
    body { font-family: sans-serif; }
    #log { max-height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 5px; margin-bottom: 10px; }
    p { margin: 0.2em 0; }
    .msg { color: blue; }
    .action { color: green; }
    .progress { color: orange; }
  </style>
</head>
<body>
<h1>–û–¢–ü –í–ª–∞–¥–∏–º–∏—Ä ONLY</h1>
<div id="log"></div>
<input id="msg" placeholder="Type a message">
<button onclick="sendMsg()">Send</button>

<script>
const logDiv = document.getElementById("log");

// —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏
function log(msg, type = 'msg') {
    const p = document.createElement("p");
    p.textContent = msg;
    if(type === 'msg') p.className = 'msg';
    if(type === 'action') p.className = 'action';
    if(type === 'progress') p.className = 'progress';
    logDiv.appendChild(p);
    logDiv.scrollTop = logDiv.scrollHeight;
}

// –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
let ws = new WebSocket("ws://localhost:8089/ws");

ws.onopen = () => log("‚úÖ Connected to server");

ws.onmessage = (event) => {
    try {
        const data = JSON.parse(event.data);

        if (data.players && Array.isArray(data.players)) {
            // —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            if (data.message) {
                log(`üìù ${data.message}`, 'msg');
            }

            // –¥–µ–π—Å—Ç–≤–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–≥—Ä–æ–∫–æ–≤
            data.players.forEach(p => {
                if (p.action !== undefined) {
                    log(`üéÆ ${p.name} action: ${p.action}`, 'action');
                } else if (p.progress !== undefined) {
                    log(`üèÅ ${p.name} progress: ${p.progress}`, 'progress');
                }
            });

        } else {
            log(JSON.stringify(data), 'msg');
        }

    } catch (e) {
        // –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ JSON ‚Äî –≤—ã–≤–æ–¥–∏–º –∫–∞–∫ –µ—Å—Ç—å
        log(event.data, 'msg');
    }
};

ws.onclose = () => log("‚ùå Disconnected");
ws.onerror = (err) => log("‚ö†Ô∏è Error: " + err);

// –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
function sendMsg() {
    const input = document.getElementById("msg");
    if(ws.readyState === WebSocket.OPEN) {
        // –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "/", —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ action, –∏–Ω–∞—á–µ –∫–∞–∫ msg
        const val = input.value.trim();
        if (!val) return;

        if(val.startsWith("/")) {
            // –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∫–∞–∫ JSON
            ws.send(JSON.stringify({action: val.slice(1)}));
        } else {
            // –æ–±—ã—á–Ω—ã–π —á–∞—Ç
            ws.send(val);
        }

        input.value = "";
    }
}
</script>
</body>
</html>
